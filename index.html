<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AIESEC</title>
  <style>
    body {
      margin: 0px;
      padding: 0px;
      width: 100vw;
      height: 100vh;
    }
    canvas {
      display: block;
    }
  </style>
  <script src="three.min.js"></script>
  <script src="OrbitControls.js"></script>
</head>
<body>
<script>
    var scene = new THREE.Scene()
    var aspectRatio = window.innerWidth / window.innerHeight
    var camera = new THREE.PerspectiveCamera(45, aspectRatio, 0.1, 10000)
    camera.position.z = 10
    var renderer = new THREE.WebGLRenderer()
    renderer.setSize(window.innerWidth, window.innerHeight)
    renderer.setClearColor(0)
    window.addEventListener('resize', function() {
      var WIDTH = window.innerWidth,
          HEIGHT = window.innerHeight;
      renderer.setSize(WIDTH, HEIGHT);
      camera.aspect = WIDTH / HEIGHT;
      camera.updateProjectionMatrix();
    });
    var controls = new THREE.OrbitControls(camera, renderer.domElement)
    controls.enableDamping = true
    controls.dampingFactor = 0.25
    controls.enableZoom = false

    var clock = new THREE.Clock()
    var time = 0
    var earthOrbitRadius = 100,
        earthOrbitAngle = 0
        earthOrbitSpeed = 0.5
    document.body.appendChild(renderer.domElement)

    var group = new THREE.Object3D()


    scene.add(new THREE.AmbientLight(0x404040))

    var ambientLight = new THREE.AmbientLight(0xFFFF99)
    scene.add(ambientLight)

    var light = new THREE.PointLight(0xFFFFFF, 1, 0)
    light.position.set(0, 0, 10)
    scene.add(light)


    var geometry = new THREE.SphereGeometry(2, 32, 32)
    var texture = THREE.ImageUtils.loadTexture("images/earthmap1k.jpg")
    var bumpTexture = THREE.ImageUtils.loadTexture('images/earthbump1k.jpg')
    var specularMap = THREE.ImageUtils.loadTexture('images/earthspec1k.jpg')

    var material = new THREE.MeshPhongMaterial({
        color: 0xaaaaaa,
        ambient: 0xaaaaaa,
        specular: 0x333333,
        map: texture,
        bumpMap: bumpTexture,
        bumpScale: 0.5,
        shininess: 10,
        specularMap: specularMap
    })

    var earth = new THREE.Mesh(geometry, material)
    var cloud = createEarthCloud()

    var starFieldGeometry  = new THREE.SphereGeometry(90, 32, 32)
    // create the material, using a texture of startfield
    var starFieldMaterial = new THREE.MeshBasicMaterial({
      map: THREE.ImageUtils.loadTexture('images/galaxy_starfield.png'),
      side: THREE.BackSide
    })
    // create the mesh based on geometry and material
    var starField  = new THREE.Mesh(starFieldGeometry, starFieldMaterial)
    scene.add(starField)
    group.add(earth)
    group.add(cloud)
    scene.add(group)

    // starField.position.z = -10;
    function render() {
        requestAnimationFrame(render)

        var delta = clock.getDelta()
        group.rotation.y += 0.1 * delta

        var time = clock.getElapsedTime() * 0.5
        // group.position.x = Math.cos(time) * 5
        // group.position.z = Math.sin(time) * 5

        renderer.render(scene, camera)
    }

    render()

    function createEarthCloud() {
      var canvasResult  = document.createElement('canvas')
        canvasResult.width  = 1024
        canvasResult.height = 512
        var contextResult = canvasResult.getContext('2d')

        // load earthcloudmap
        var imageMap  = new Image();
        imageMap.addEventListener("load", function() {
          
          // create dataMap ImageData for earthcloudmap
          var canvasMap = document.createElement('canvas')
          canvasMap.width = imageMap.width
          canvasMap.height= imageMap.height
          var contextMap  = canvasMap.getContext('2d')
          contextMap.drawImage(imageMap, 0, 0)
          var dataMap = contextMap.getImageData(0, 0, canvasMap.width, canvasMap.height)

          // load earthcloudmaptrans
          var imageTrans  = new Image();
          imageTrans.addEventListener("load", function(){
            // create dataTrans ImageData for earthcloudmaptrans
            var canvasTrans   = document.createElement('canvas')
            canvasTrans.width = imageTrans.width
            canvasTrans.height  = imageTrans.height
            var contextTrans  = canvasTrans.getContext('2d')
            contextTrans.drawImage(imageTrans, 0, 0)
            var dataTrans   = contextTrans.getImageData(0, 0, canvasTrans.width, canvasTrans.height)
            // merge dataMap + dataTrans into dataResult
            var dataResult    = contextMap.createImageData(canvasMap.width, canvasMap.height)
            for(var y = 0, offset = 0; y < imageMap.height; y++){
              for(var x = 0; x < imageMap.width; x++, offset += 4){
                dataResult.data[offset+0] = dataMap.data[offset+0]
                dataResult.data[offset+1] = dataMap.data[offset+1]
                dataResult.data[offset+2] = dataMap.data[offset+2]
                dataResult.data[offset+3] = 255 - dataTrans.data[offset+0]
              }
            }
            // update texture with result
            contextResult.putImageData(dataResult,0,0)
            material.map.needsUpdate = true;
          })
          imageTrans.src  = 'images/earthcloudmaptrans.jpg';
        }, false);
        imageMap.src  = 'images/earthcloudmap.jpg';

        var geometry  = new THREE.SphereGeometry(2.05, 32, 32)
        var material  = new THREE.MeshPhongMaterial({
          map   : new THREE.Texture(canvasResult),
          side    : THREE.DoubleSide,
          transparent : true,
          opacity   : 0.8,
        })
        var mesh  = new THREE.Mesh(geometry, material)
        return mesh
    }
</script>
</body>
</html>